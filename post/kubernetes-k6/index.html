<html>
<head>
    <meta charset="utf-8"/>
<meta name="description" content=""/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>åœ¨Kubernetesä¸Šéƒ¨ç½²k6çš„è¯¦ç»†æ­¥éª¤ | Nana&#39;s Blog</title>

<link rel="shortcut icon" href="https://nanagan.github.io/favicon.ico?v=1615274526411">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://nanagan.github.io/styles/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css">

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dart.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script>
<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->



    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <nav class="navbar navbar-expand-lg">
    <div class="navbar-brand">
        <img class="user-avatar" src="/images/avatar.png" alt="å¤´åƒ">
        <div class="site-name gt-c-content-color-first">
            Nana&#39;s Blog
        </div>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
                <div class="nav-item">
                    
                        <a href="/" class="menu gt-a-link">
                            é¦–é¡µ
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/archives" class="menu gt-a-link">
                            å½’æ¡£
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/tags" class="menu gt-a-link">
                            æ ‡ç­¾
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/post/about" class="menu gt-a-link">
                            å…³äº
                        </a>
                    
                </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1615274526411" action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="æœç´¢æ–‡ç« " />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>

    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    åœ¨Kubernetesä¸Šéƒ¨ç½²k6çš„è¯¦ç»†æ­¥éª¤
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        Â· 2021-03-09 Â·
                    </time>
                    
                        <a href="https://nanagan.github.io/tag/L2_5xxyiA/" class="post-tags">
                            # å‹æµ‹
                        </a>
                    
                </div>
                <div class="post-content">
                    <h1 id="å…·ä½“æ­¥éª¤">å…·ä½“æ­¥éª¤</h1>
<h2 id="å‰ç½®æ¡ä»¶">å‰ç½®æ¡ä»¶</h2>
<ol>
<li>
<p>ä¸‹è½½kubectl</p>
<p><code>brew install kubectl</code></p>
</li>
<li>
<p>å®‰è£…helm</p>
<p><code>brew install helm</code></p>
</li>
<li>
<p>æ–°å»ºä¸€ä¸ªæ”¾ç½®k6çš„æ–‡ä»¶å¤¹</p>
</li>
</ol>
<h2 id="é…ç½®å¹¶å®‰è£…k6">é…ç½®å¹¶å®‰è£…k6</h2>
<ol>
<li>
<p>è¾“å…¥<code>vim k6-deployment.yaml</code></p>
</li>
<li>
<p>åœ¨é‡Œé¢è¯¦ç»†å†™å‡ºå¯¹k6çš„é…ç½®</p>
<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: k6-deployment
  labels:
    app: k6
spec:
  replicas: 1
  selector:
    matchLabels:
      app: k6
  template:
    metadata:
      labels:
        app: k6
    spec:
      containers:
      - name: k6
        image: loadimpact/k6
        command: [&quot;tail&quot;,&quot;-f&quot;,&quot;/dev/null&quot;]
        resources:
          requests:
            memory: &quot;64Mi&quot;
            cpu: &quot;250m&quot;
          limits:
            memory: &quot;128Mi&quot;
            cpu: &quot;500m&quot;


</code></pre>
</li>
<li>
<p>æ¥ç€åœ¨k8sä¸Šéƒ¨ç½²k6ï¼Œnamespaceçš„åå­—è‡ªå·±å®šä¹‰ï¼Œ<code>kubectl apply -f k6-deployment.yaml -n k6</code></p>
<p>æ­¤æ—¶å®ƒä¼šæ˜¾ç¤º</p>
<pre><code>deployment.apps/k6-deployment created
</code></pre>
<p>è¯´æ˜éƒ¨ç½²å·²ç»æˆåŠŸã€‚</p>
</li>
<li>
<p>è¾“å…¥<code>kubectl -n k6 exec -it k6-deployment-57fd465f75-wxfj8 /bin/sh</code>è¿è¡Œk6ï¼Œè¿è¡ŒæˆåŠŸåå¾—åˆ°ä¸‹å›¾</p>
<p>![image-20210309151300435](/Users/nanagan/Library/Application Support/typora-user-images/image-20210309151300435.png)</p>
</li>
</ol>
<h2 id="è¿›è¡Œå‹æµ‹">è¿›è¡Œå‹æµ‹</h2>
<ol>
<li>
<p><strong>ç¼–å†™è„šæœ¬</strong></p>
<p>æ­¤å¤„ä½¿ç”¨k6å®˜ç½‘ä¸Šçš„æµ‹è¯•è„šæœ¬è¿›è¡Œä¸€æ¬¡å°å‹æµ‹ï¼Œåœ¨ç»ˆç«¯è¾“å…¥<code>vi è„šæœ¬åç§°.js</code>ï¼Œå¹¶åœ¨å¼¹å‡ºæ¥çš„çª—å£ä¸­è¾“å…¥è„šæœ¬å†…å®¹ï¼Œæ­¤å¤„ä½¿ç”¨çš„è„šæœ¬ä¸º</p>
<pre><code class="language-javascript">import http from 'k6/http';
import { sleep } from 'k6';
export default function () {
  http.get('http://test.k6.io');
  sleep(1);

</code></pre>
</li>
<li>
<p><strong>è¿è¡Œè„šæœ¬</strong></p>
<p>è¾“å…¥å‘½ä»¤<code>k6 run è„šæœ¬åç§°.js</code>ï¼Œç„¶åæ˜¾ç¤º</p>
<p>![image-20210309151903678](/Users/nanagan/Library/Application Support/typora-user-images/image-20210309151903678.png)</p>
<p>å³å‹æµ‹æˆåŠŸã€‚</p>
</li>
</ol>
<h1 id="é—®é¢˜æ±‡æ€»">é—®é¢˜æ±‡æ€»</h1>
<ol>
<li>
<p>å¦‚æœè¾“å…¥<code>kubectl get pods -n k6</code>ï¼Œå´æ˜¾ç¤º</p>
<pre><code>NAME                             READY   STATUS             RESTARTS   AGE
k6-deployment-84f77b464f-2qjkb   0/1     CrashLoopBackOff   1          23s
</code></pre>
<p>è¯´æ˜è¿™ä¸ªpodä¸€ç›´åœ¨é‡å¤ç€ã€å¯åŠ¨ï¼Œå´©æºƒï¼Œå†æ¬¡å¯åŠ¨ï¼Œç„¶åå†æ¬¡å´©æºƒã€‘çš„è¿‡ç¨‹ã€‚</p>
<p><strong>è§£å†³æ–¹æ³•ï¼š</strong></p>
<p>åœ¨<code>k6-deployment.yaml</code>æ–‡ä»¶é‡Œçš„containeré‡ŒåŠ ä¸Š<code>command: [&quot;tail&quot;,&quot;-f&quot;,&quot;/dev/null&quot;]</code>ï¼Œè¿™æ¡å‘½ä»¤çš„ä½œç”¨æ˜¯ä¿æŒå®¹å™¨ä¸€ç›´å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œä¸Šé¢çš„yamlæ–‡ä»¶é‡Œå·²ç»åŠ å¥½äº†ã€‚</p>
<blockquote>
<p>æ³¨ï¼šæ­¤å‘½ä»¤ä¸€èˆ¬ç”¨äºã€ docker å®¹å™¨ä¸­çš„è¿›ç¨‹(pid 1)æ²¡æœ‰åœ¨å‰å°è¿è¡Œï¼Œå¦‚æœå‰å°æ²¡æœ‰ä»»ä½•è¿›ç¨‹è¿è¡Œï¼Œdocker ä¼šè‡ªåŠ¨å…³é—­è‡ªå·±ã€‘çš„æƒ…å†µ</p>
</blockquote>
<p>æ­¤æ—¶è¾“å…¥<code>kubectl get pods -n k6</code>ï¼Œå¯ä»¥å¾—åˆ°</p>
<pre><code>NAME                             READY   STATUS        RESTARTS   AGE
k6-deployment-57fd465f75-wxfj8   1/1     Running       0          9s
k6-deployment-84f77b464f-2qjkb   0/1     Terminating   6          7m15s
</code></pre>
</li>
</ol>

                </div>
            </article>
        </div>

        
            <div class="next-post">
                <div class="next gt-c-content-color-first">ä¸‹ä¸€ç¯‡</div>
                <a href="https://nanagan.github.io/post/18246586/" class="post-title gt-a-link">
                    æµ…è°ˆä¸åŒå‹æµ‹å¹³å°çš„ä½¿ç”¨ä½“éªŒï¼ˆå¯¹æ¯”JMeterï¼‰
                </a>
            </div>
        

        
            <span id="/post/kubernetes-k6/" class="leancloud_visitors" data-flag-title="åœ¨Kubernetesä¸Šéƒ¨ç½²k6çš„è¯¦ç»†æ­¥éª¤">
                <em class="post-meta-item-text">é˜…è¯»é‡ </em>
                <i class="leancloud-visitors-count">0</i>
            </span>
        

        

        
            <script src='https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js'></script>

<style>
	div#vcomments{
		width:100%;
		max-width: 1000px;
		padding: 2.5%
	}
</style>


	<div id="vcomments"></div>

<script>
	new Valine({
		el: '#vcomments',
		appId: 'Fwb8Sh0if5a89ivip2D7ltLE-gzGzoHsz',
		appKey: 'yKd7GvF6flIjh1opobdCmzdI',
		avatar: '',
		pageSize: 5,
		recordIp: false,
		placeholder: 'æ¬¢è¿ç•™è¨€ğŸ‘',
		visitor: true,
	});
</script>

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first">é¹…å‚ä½çº§å·¥ç¨‹å¸ˆï¼ˆå¤§é›¾</div>
    <div class="social-container">
        
            
        
            
        
            
        
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
    </div>
    <div>
        Theme by <a href="https://imhanjie.com/" target="_blank">imhanjie</a>, Powered by <a
                href="https://github.com/getgridea/gridea" target="_blank">Gridea | <a href="https://nanagan.github.io/atom.xml" target="_blank">RSS</a></a>
    </div>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

    </div>
</div>
</body>
</html>
